
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>NewControllerManagerCommand · Kubernetes 学习笔记</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="胡伟煌">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-image-captions/image-captions.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="deployment-controller.html" />
    
    
    <link rel="prev" href="controller-manager-xmind.html" />
    

    
        <link rel="shortcut icon" href='../images/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../images/favicon.ico' type="image/x-icon">
    
    
        <link rel="apple-touch-icon" href='../images/favicon.ico'>
    
    
        
        <link rel="apple-touch-icon" sizes="120x120" href="../images/favicon.ico">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../images/favicon.ico">
        
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"repo":"huweihuang/k8s-source-code-analysis","types":["star"],"size":"small"};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://www.huweihuang.com" target="_blank" class="custom-link">胡伟煌的博客</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/kubernetes-notes/" target="_blank" class="custom-link">Kubernetes 学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/golang-notes/" target="_blank" class="custom-link">Golang 学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/linux-notes/" target="_blank" class="custom-link">Linux 学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/data-structure-notes/" target="_blank" class="custom-link">数据结构学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/python-notes/" target="_blank" class="custom-link">Python 学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/blockchain-notes/" target="_blank" class="custom-link">Blockchain 学习笔记</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        <li class="header">前言</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    序言
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">kube-apiserver</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../kube-apiserver/NewAPIServerCommand.html">
            
                <a href="../kube-apiserver/NewAPIServerCommand.html">
            
                    
                        <b>2.1.</b>
                    
                    NewAPIServerCommand
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">kube-controller-manager</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="controller-manager-xmind.html">
            
                <a href="controller-manager-xmind.html">
            
                    
                        <b>3.1.</b>
                    
                    源码思维导图
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.2" data-path="NewControllerManagerCommand.html">
            
                <a href="NewControllerManagerCommand.html">
            
                    
                        <b>3.2.</b>
                    
                    NewControllerManagerCommand
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="deployment-controller.html">
            
                <a href="deployment-controller.html">
            
                    
                        <b>3.3.</b>
                    
                    DeploymentController
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" >
            
                <span>
            
                    
                        <b>3.4.</b>
                    
                    Informer机制
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="list-watch/informer.html">
            
                <a href="list-watch/informer.html">
            
                    
                        <b>3.4.1.</b>
                    
                    Informer原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.2" data-path="list-watch/sharedIndexInformer.html">
            
                <a href="list-watch/sharedIndexInformer.html">
            
                    
                        <b>3.4.2.</b>
                    
                    sharedIndexInformer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.3" data-path="list-watch/reflector.html">
            
                <a href="list-watch/reflector.html">
            
                    
                        <b>3.4.3.</b>
                    
                    Reflector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.4" data-path="list-watch/DeltaFIFO.html">
            
                <a href="list-watch/DeltaFIFO.html">
            
                    
                        <b>3.4.4.</b>
                    
                    DeltaFIFO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.5" data-path="list-watch/processLoop.html">
            
                <a href="list-watch/processLoop.html">
            
                    
                        <b>3.4.5.</b>
                    
                    processLoop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.6" data-path="list-watch/summary.html">
            
                <a href="list-watch/summary.html">
            
                    
                        <b>3.4.6.</b>
                    
                    总结
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">kube-scheduler</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../kube-scheduler/scheduler-xmind.html">
            
                <a href="../kube-scheduler/scheduler-xmind.html">
            
                    
                        <b>4.1.</b>
                    
                    源码思维导图
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../kube-scheduler/NewSchedulerCommand.html">
            
                <a href="../kube-scheduler/NewSchedulerCommand.html">
            
                    
                        <b>4.1.1.</b>
                    
                    NewSchedulerCommand
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../kube-scheduler/registerAlgorithmProvider.html">
            
                <a href="../kube-scheduler/registerAlgorithmProvider.html">
            
                    
                        <b>4.1.2.</b>
                    
                    registerAlgorithmProvider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../kube-scheduler/scheduleOne.html">
            
                <a href="../kube-scheduler/scheduleOne.html">
            
                    
                        <b>4.1.3.</b>
                    
                    scheduleOne
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="../kube-scheduler/findNodesThatFit.html">
            
                <a href="../kube-scheduler/findNodesThatFit.html">
            
                    
                        <b>4.1.4.</b>
                    
                    findNodesThatFit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="../kube-scheduler/PrioritizeNodes.html">
            
                <a href="../kube-scheduler/PrioritizeNodes.html">
            
                    
                        <b>4.1.5.</b>
                    
                    PrioritizeNodes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="../kube-scheduler/preempt.html">
            
                <a href="../kube-scheduler/preempt.html">
            
                    
                        <b>4.1.6.</b>
                    
                    preempt
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">kubelet</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../kubelet/kubelet-xmind.html">
            
                <a href="../kubelet/kubelet-xmind.html">
            
                    
                        <b>5.1.</b>
                    
                    源码思维导图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../kubelet/NewKubeletCommand.html">
            
                <a href="../kubelet/NewKubeletCommand.html">
            
                    
                        <b>5.2.</b>
                    
                    NewKubeletCommand
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../kubelet/NewMainKubelet.html">
            
                <a href="../kubelet/NewMainKubelet.html">
            
                    
                        <b>5.3.</b>
                    
                    NewMainKubelet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../kubelet/startKubelet.html">
            
                <a href="../kubelet/startKubelet.html">
            
                    
                        <b>5.4.</b>
                    
                    startKubelet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="../kubelet/syncLoopIteration.html">
            
                <a href="../kubelet/syncLoopIteration.html">
            
                    
                        <b>5.5.</b>
                    
                    syncLoopIteration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="../kubelet/syncPod.html">
            
                <a href="../kubelet/syncPod.html">
            
                    
                        <b>5.6.</b>
                    
                    syncPod
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >NewControllerManagerCommand</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="kube-controller-manager&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF08;&#x4E00;&#xFF09;&#x4E4B;-newcontrollermanagercommand">kube-controller-manager&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF08;&#x4E00;&#xFF09;&#x4E4B; NewControllerManagerCommand</h1>
<blockquote>
<p>&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x5206;&#x6790;&#x57FA;&#x4E8E; <code>kubernetes v1.12.0</code> &#x7248;&#x672C;&#x3002;</p>
<p>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x5206;&#x6790;<a href="https://github.com/kubernetes/kubernetes/tree/v1.12.0/cmd/kube-controller-manager" target="_blank">https://github.com/kubernetes/kubernetes/tree/v1.12.0/cmd/kube-controller-manager</a> &#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
</blockquote>
<p>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x5206;&#x6790; <code>kubernetes/cmd/kube-controller-manager</code>&#x90E8;&#x5206;&#xFF0C;&#x8BE5;&#x90E8;&#x5206;&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x5404;&#x79CD;&#x7C7B;&#x578B;&#x7684;<code>controller</code>&#x7684;&#x53C2;&#x6570;&#x89E3;&#x6790;&#xFF0C;&#x53CA;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4F8B;&#x5982; <code>deployment controller</code> &#x548C;<code>statefulset controller</code>&#x3002;&#x5E76;&#x6CA1;&#x6709;&#x5177;&#x4F53;<code>controller</code>&#x8FD0;&#x884C;&#x7684;&#x8BE6;&#x7EC6;&#x903B;&#x8F91;&#xFF0C;&#x8BE5;&#x90E8;&#x5206;&#x4F4D;&#x4E8E;<code>kubernetes/pkg/controller</code>&#x6A21;&#x5757;&#xFF0C;&#x5F85;&#x540E;&#x7EED;&#x6587;&#x7AE0;&#x5206;&#x6790;&#x3002;</p>
<p><code>kube-controller-manager</code>&#x7684;<code>cmd</code>&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">kube-controller-manager
&#x251C;&#x2500;&#x2500; app
&#x2502;   &#x251C;&#x2500;&#x2500; apps.go   <span class="token comment"># &#x5305;&#x542B;:startDeploymentController&#x3001;startReplicaSetController&#x3001;startStatefulSetController&#x3001;startDaemonSetController</span>
&#x2502;   &#x251C;&#x2500;&#x2500; autoscaling.go <span class="token comment"># startHPAController</span>
&#x2502;   &#x251C;&#x2500;&#x2500; batch.go  <span class="token comment"># startJobController&#x3001;startCronJobController</span>
&#x2502;   &#x251C;&#x2500;&#x2500; bootstrap.go
&#x2502;   &#x251C;&#x2500;&#x2500; certificates.go
&#x2502;   &#x251C;&#x2500;&#x2500; cloudproviders.go
&#x2502;   &#x251C;&#x2500;&#x2500; config
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; config.go   <span class="token comment"># config: controller manager&#x6267;&#x884C;&#x7684;&#x4E0A;&#x4E0B;&#x6587;</span>
&#x2502;   &#x251C;&#x2500;&#x2500; controllermanager.go   <span class="token comment"># &#x5305;&#x542B;:NewControllerManagerCommand&#x3001;Run&#x3001;NewControllerInitializers&#x3001;StartControllers&#x7B49;</span>
&#x2502;   &#x251C;&#x2500;&#x2500; core.go   <span class="token comment"># startServiceController&#x3001;startNodeIpamController&#x3001;startPersistentVolumeBinderController&#x3001;startNamespaceController&#x7B49;</span>
&#x2502;   &#x251C;&#x2500;&#x2500; options    <span class="token comment"># &#x5305;&#x542B;&#x4E0D;&#x540C;controller&#x7684;option&#x53C2;&#x6570;</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; attachdetachcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; csrsigningcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; daemonsetcontroller.go   <span class="token comment"># DaemonSetControllerOptions</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; deploymentcontroller.go  <span class="token comment"># DeploymentControllerOptions</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; deprecatedcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; endpointcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; garbagecollectorcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; hpacontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; jobcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; namespacecontroller.go   <span class="token comment"># NamespaceControllerOptions</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; nodeipamcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; nodelifecyclecontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; options.go  <span class="token comment"># KubeControllerManagerOptions&#x3001;NewKubeControllerManagerOptions</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; persistentvolumebindercontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; podgccontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; replicasetcontroller.go   <span class="token comment"># ReplicaSetControllerOptions</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; replicationcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; resourcequotacontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; serviceaccountcontroller.go
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; ttlafterfinishedcontroller.go
&#x2514;&#x2500;&#x2500; controller-manager.go  <span class="token comment"># main&#x5165;&#x53E3;&#x51FD;&#x6570;</span>
</code></pre>
<h1 id="1-main&#x51FD;&#x6570;">1. <a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/controller-manager.go#L41" target="_blank">Main&#x51FD;&#x6570;</a></h1>
<p><code>kube-controller-manager</code>&#x7684;&#x5165;&#x53E3;&#x51FD;&#x6570;<code>Main</code>&#x51FD;&#x6570;&#xFF0C;&#x4ECD;&#x7136;&#x662F;&#x91C7;&#x7528;&#x7EDF;&#x4E00;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF0C;&#x4F7F;&#x7528;<a href="https://github.com/spf13/cobra" target="_blank">Cobra</a>&#x547D;&#x4EE4;&#x884C;&#x6846;&#x67B6;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    command <span class="token operator">:=</span> app<span class="token punctuation">.</span><span class="token function">NewControllerManagerCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// TODO: once we switch everything over to Cobra commands, we can go back to calling</span>
    <span class="token comment">// utilflag.InitFlags() (by removing its pflag.Parse() call). For now, we have to set the</span>
    <span class="token comment">// normalize func and add the go flag set by hand.</span>
    pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">.</span><span class="token function">SetNormalizeFunc</span><span class="token punctuation">(</span>utilflag<span class="token punctuation">.</span>WordSepNormalizeFunc<span class="token punctuation">)</span>
    pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">.</span><span class="token function">AddGoFlagSet</span><span class="token punctuation">(</span>goflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">)</span>
    <span class="token comment">// utilflag.InitFlags()</span>
    logs<span class="token punctuation">.</span><span class="token function">InitLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">defer</span> logs<span class="token punctuation">.</span><span class="token function">FlushLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">:=</span> command<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// &#x521D;&#x59CB;&#x5316;&#x547D;&#x4EE4;&#x884C;&#x7ED3;&#x6784;&#x4F53;</span>
command <span class="token operator">:=</span> app<span class="token punctuation">.</span><span class="token function">NewControllerManagerCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// &#x6267;&#x884C;Execute</span>
err <span class="token operator">:=</span> command<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="2-newcontrollermanagercommand">2. <a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/controllermanager.go#L77" target="_blank">NewControllerManagerCommand</a></h1>
<p>&#x8BE5;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x4F4D;&#x4E8E;&#xFF1A;<code>kubernetes/cmd/kube-controller-manager/app/controllermanager.go</code></p>
<pre class="language-"><code class="lang-go"><span class="token comment">// NewControllerManagerCommand creates a *cobra.Command object with default parameters</span>
<span class="token keyword">func</span> <span class="token function">NewControllerManagerCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    cmd <span class="token operator">:=</span> <span class="token operator">&amp;</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">{</span>
        Use<span class="token punctuation">:</span> <span class="token string">&quot;kube-controller-manager&quot;</span><span class="token punctuation">,</span>
        Long<span class="token punctuation">:</span> <span class="token string">`The Kubernetes controller manager is a daemon that embeds
the core control loops shipped with Kubernetes. In applications of robotics and
automation, a control loop is a non-terminating loop that regulates the state of
the system. In Kubernetes, a controller is a control loop that watches the shared
state of the cluster through the apiserver and makes changes attempting to move the
current state towards the desired state. Examples of controllers that ship with
Kubernetes today are the replication controller, endpoints controller, namespace
controller, and serviceaccounts controller.`</span><span class="token punctuation">,</span>
        Run<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>cmd <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">,</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            verflag<span class="token punctuation">.</span><span class="token function">PrintAndExitIfRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            utilflag<span class="token punctuation">.</span><span class="token function">PrintFlags</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            c<span class="token punctuation">,</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Config</span><span class="token punctuation">(</span><span class="token function">KnownControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ControllersDisabledByDefault<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
                os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">Run</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wait<span class="token punctuation">.</span>NeverStop<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
                os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6784;&#x5EFA;&#x4E00;&#x4E2A;<code>*cobra.Command</code>&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;<code>Run</code>&#x51FD;&#x6570;&#x3002;</p>
<h2 id="21-newkubecontrollermanageroptions">2.1. NewKubeControllerManagerOptions</h2>
<pre class="language-"><code class="lang-go">s<span class="token punctuation">,</span> err <span class="token operator">:=</span> options<span class="token punctuation">.</span><span class="token function">NewKubeControllerManagerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    glog<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;unable to initialize command options: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x521D;&#x59CB;&#x5316;controllerManager&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x4E2D;&#x4E3B;&#x8981;&#x5305;&#x62EC;&#x4E86;&#x5404;&#x79CD;controller&#x7684;option&#xFF0C;&#x4F8B;&#x5982;<code>DeploymentControllerOptions</code>:</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// DeploymentControllerOptions holds the DeploymentController options.</span>
<span class="token keyword">type</span> DeploymentControllerOptions <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    ConcurrentDeploymentSyncs      <span class="token builtin">int32</span>
    DeploymentControllerSyncPeriod metav1<span class="token punctuation">.</span>Duration
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// NewKubeControllerManagerOptions creates a new KubeControllerManagerOptions with a default config.</span>
<span class="token keyword">func</span> <span class="token function">NewKubeControllerManagerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>KubeControllerManagerOptions<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    componentConfig<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">NewDefaultComponentConfig</span><span class="token punctuation">(</span>ports<span class="token punctuation">.</span>InsecureKubeControllerManagerPort<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>

    s <span class="token operator">:=</span> KubeControllerManagerOptions<span class="token punctuation">{</span>
        Generic<span class="token punctuation">:</span>         cmoptions<span class="token punctuation">.</span><span class="token function">NewGenericControllerManagerConfigurationOptions</span><span class="token punctuation">(</span>componentConfig<span class="token punctuation">.</span>Generic<span class="token punctuation">)</span><span class="token punctuation">,</span>
        KubeCloudShared<span class="token punctuation">:</span> cmoptions<span class="token punctuation">.</span><span class="token function">NewKubeCloudSharedOptions</span><span class="token punctuation">(</span>componentConfig<span class="token punctuation">.</span>KubeCloudShared<span class="token punctuation">)</span><span class="token punctuation">,</span>
        AttachDetachController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>AttachDetachControllerOptions<span class="token punctuation">{</span>
            ReconcilerSyncLoopPeriod<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>AttachDetachController<span class="token punctuation">.</span>ReconcilerSyncLoopPeriod<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        CSRSigningController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>CSRSigningControllerOptions<span class="token punctuation">{</span>
            ClusterSigningCertFile<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>CSRSigningController<span class="token punctuation">.</span>ClusterSigningCertFile<span class="token punctuation">,</span>
            ClusterSigningKeyFile<span class="token punctuation">:</span>  componentConfig<span class="token punctuation">.</span>CSRSigningController<span class="token punctuation">.</span>ClusterSigningKeyFile<span class="token punctuation">,</span>
            ClusterSigningDuration<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>CSRSigningController<span class="token punctuation">.</span>ClusterSigningDuration<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        DaemonSetController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>DaemonSetControllerOptions<span class="token punctuation">{</span>
            ConcurrentDaemonSetSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>DaemonSetController<span class="token punctuation">.</span>ConcurrentDaemonSetSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        DeploymentController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>DeploymentControllerOptions<span class="token punctuation">{</span>
            ConcurrentDeploymentSyncs<span class="token punctuation">:</span>      componentConfig<span class="token punctuation">.</span>DeploymentController<span class="token punctuation">.</span>ConcurrentDeploymentSyncs<span class="token punctuation">,</span>
            DeploymentControllerSyncPeriod<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>DeploymentController<span class="token punctuation">.</span>DeploymentControllerSyncPeriod<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        DeprecatedFlags<span class="token punctuation">:</span> <span class="token operator">&amp;</span>DeprecatedControllerOptions<span class="token punctuation">{</span>
            RegisterRetryCount<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>DeprecatedController<span class="token punctuation">.</span>RegisterRetryCount<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        EndpointController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>EndpointControllerOptions<span class="token punctuation">{</span>
            ConcurrentEndpointSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>EndpointController<span class="token punctuation">.</span>ConcurrentEndpointSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        GarbageCollectorController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>GarbageCollectorControllerOptions<span class="token punctuation">{</span>
            ConcurrentGCSyncs<span class="token punctuation">:</span>      componentConfig<span class="token punctuation">.</span>GarbageCollectorController<span class="token punctuation">.</span>ConcurrentGCSyncs<span class="token punctuation">,</span>
            EnableGarbageCollector<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>GarbageCollectorController<span class="token punctuation">.</span>EnableGarbageCollector<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        HPAController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>HPAControllerOptions<span class="token punctuation">{</span>
            HorizontalPodAutoscalerSyncPeriod<span class="token punctuation">:</span>                   componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerSyncPeriod<span class="token punctuation">,</span>
            HorizontalPodAutoscalerUpscaleForbiddenWindow<span class="token punctuation">:</span>       componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerUpscaleForbiddenWindow<span class="token punctuation">,</span>
            HorizontalPodAutoscalerDownscaleForbiddenWindow<span class="token punctuation">:</span>     componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerDownscaleForbiddenWindow<span class="token punctuation">,</span>
            HorizontalPodAutoscalerDownscaleStabilizationWindow<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerDownscaleStabilizationWindow<span class="token punctuation">,</span>
            HorizontalPodAutoscalerCPUInitializationPeriod<span class="token punctuation">:</span>      componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerCPUInitializationPeriod<span class="token punctuation">,</span>
            HorizontalPodAutoscalerInitialReadinessDelay<span class="token punctuation">:</span>        componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerInitialReadinessDelay<span class="token punctuation">,</span>
            HorizontalPodAutoscalerTolerance<span class="token punctuation">:</span>                    componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerTolerance<span class="token punctuation">,</span>
            HorizontalPodAutoscalerUseRESTClients<span class="token punctuation">:</span>               componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerUseRESTClients<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        JobController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>JobControllerOptions<span class="token punctuation">{</span>
            ConcurrentJobSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>JobController<span class="token punctuation">.</span>ConcurrentJobSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        NamespaceController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>NamespaceControllerOptions<span class="token punctuation">{</span>
            NamespaceSyncPeriod<span class="token punctuation">:</span>      componentConfig<span class="token punctuation">.</span>NamespaceController<span class="token punctuation">.</span>NamespaceSyncPeriod<span class="token punctuation">,</span>
            ConcurrentNamespaceSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>NamespaceController<span class="token punctuation">.</span>ConcurrentNamespaceSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        NodeIPAMController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>NodeIPAMControllerOptions<span class="token punctuation">{</span>
            NodeCIDRMaskSize<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>NodeIPAMController<span class="token punctuation">.</span>NodeCIDRMaskSize<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        NodeLifecycleController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>NodeLifecycleControllerOptions<span class="token punctuation">{</span>
            EnableTaintManager<span class="token punctuation">:</span>     componentConfig<span class="token punctuation">.</span>NodeLifecycleController<span class="token punctuation">.</span>EnableTaintManager<span class="token punctuation">,</span>
            NodeMonitorGracePeriod<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>NodeLifecycleController<span class="token punctuation">.</span>NodeMonitorGracePeriod<span class="token punctuation">,</span>
            NodeStartupGracePeriod<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>NodeLifecycleController<span class="token punctuation">.</span>NodeStartupGracePeriod<span class="token punctuation">,</span>
            PodEvictionTimeout<span class="token punctuation">:</span>     componentConfig<span class="token punctuation">.</span>NodeLifecycleController<span class="token punctuation">.</span>PodEvictionTimeout<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        PersistentVolumeBinderController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>PersistentVolumeBinderControllerOptions<span class="token punctuation">{</span>
            PVClaimBinderSyncPeriod<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>PersistentVolumeBinderController<span class="token punctuation">.</span>PVClaimBinderSyncPeriod<span class="token punctuation">,</span>
            VolumeConfiguration<span class="token punctuation">:</span>     componentConfig<span class="token punctuation">.</span>PersistentVolumeBinderController<span class="token punctuation">.</span>VolumeConfiguration<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        PodGCController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>PodGCControllerOptions<span class="token punctuation">{</span>
            TerminatedPodGCThreshold<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>PodGCController<span class="token punctuation">.</span>TerminatedPodGCThreshold<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ReplicaSetController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>ReplicaSetControllerOptions<span class="token punctuation">{</span>
            ConcurrentRSSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>ReplicaSetController<span class="token punctuation">.</span>ConcurrentRSSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ReplicationController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>ReplicationControllerOptions<span class="token punctuation">{</span>
            ConcurrentRCSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>ReplicationController<span class="token punctuation">.</span>ConcurrentRCSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ResourceQuotaController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>ResourceQuotaControllerOptions<span class="token punctuation">{</span>
            ResourceQuotaSyncPeriod<span class="token punctuation">:</span>      componentConfig<span class="token punctuation">.</span>ResourceQuotaController<span class="token punctuation">.</span>ResourceQuotaSyncPeriod<span class="token punctuation">,</span>
            ConcurrentResourceQuotaSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>ResourceQuotaController<span class="token punctuation">.</span>ConcurrentResourceQuotaSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        SAController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>SAControllerOptions<span class="token punctuation">{</span>
            ConcurrentSATokenSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>SAController<span class="token punctuation">.</span>ConcurrentSATokenSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ServiceController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>cmoptions<span class="token punctuation">.</span>ServiceControllerOptions<span class="token punctuation">{</span>
            ConcurrentServiceSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>ServiceController<span class="token punctuation">.</span>ConcurrentServiceSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        TTLAfterFinishedController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>TTLAfterFinishedControllerOptions<span class="token punctuation">{</span>
            ConcurrentTTLSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>TTLAfterFinishedController<span class="token punctuation">.</span>ConcurrentTTLSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        SecureServing<span class="token punctuation">:</span> apiserveroptions<span class="token punctuation">.</span><span class="token function">NewSecureServingOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithLoopback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        InsecureServing<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>apiserveroptions<span class="token punctuation">.</span>DeprecatedInsecureServingOptions<span class="token punctuation">{</span>
            BindAddress<span class="token punctuation">:</span> net<span class="token punctuation">.</span><span class="token function">ParseIP</span><span class="token punctuation">(</span>componentConfig<span class="token punctuation">.</span>Generic<span class="token punctuation">.</span>Address<span class="token punctuation">)</span><span class="token punctuation">,</span>
            BindPort<span class="token punctuation">:</span>    <span class="token function">int</span><span class="token punctuation">(</span>componentConfig<span class="token punctuation">.</span>Generic<span class="token punctuation">.</span>Port<span class="token punctuation">)</span><span class="token punctuation">,</span>
            BindNetwork<span class="token punctuation">:</span> <span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithLoopback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Authentication<span class="token punctuation">:</span> apiserveroptions<span class="token punctuation">.</span><span class="token function">NewDelegatingAuthenticationOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Authorization<span class="token punctuation">:</span>  apiserveroptions<span class="token punctuation">.</span><span class="token function">NewDelegatingAuthorizationOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    s<span class="token punctuation">.</span>Authentication<span class="token punctuation">.</span>RemoteKubeConfigFileOptional <span class="token operator">=</span> <span class="token boolean">true</span>
    s<span class="token punctuation">.</span>Authorization<span class="token punctuation">.</span>RemoteKubeConfigFileOptional <span class="token operator">=</span> <span class="token boolean">true</span>
    s<span class="token punctuation">.</span>Authorization<span class="token punctuation">.</span>AlwaysAllowPaths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;/healthz&quot;</span><span class="token punctuation">}</span>

    s<span class="token punctuation">.</span>SecureServing<span class="token punctuation">.</span>ServerCert<span class="token punctuation">.</span>CertDirectory <span class="token operator">=</span> <span class="token string">&quot;/var/run/kubernetes&quot;</span>
    s<span class="token punctuation">.</span>SecureServing<span class="token punctuation">.</span>ServerCert<span class="token punctuation">.</span>PairName <span class="token operator">=</span> <span class="token string">&quot;kube-controller-manager&quot;</span>
    s<span class="token punctuation">.</span>SecureServing<span class="token punctuation">.</span>BindPort <span class="token operator">=</span> ports<span class="token punctuation">.</span>KubeControllerManagerPort

    gcIgnoredResources <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>kubectrlmgrconfig<span class="token punctuation">.</span>GroupResource<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>garbagecollector<span class="token punctuation">.</span><span class="token function">DefaultIgnoredResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> r <span class="token operator">:=</span> <span class="token keyword">range</span> garbagecollector<span class="token punctuation">.</span><span class="token function">DefaultIgnoredResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gcIgnoredResources <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>gcIgnoredResources<span class="token punctuation">,</span> kubectrlmgrconfig<span class="token punctuation">.</span>GroupResource<span class="token punctuation">{</span>Group<span class="token punctuation">:</span> r<span class="token punctuation">.</span>Group<span class="token punctuation">,</span> Resource<span class="token punctuation">:</span> r<span class="token punctuation">.</span>Resource<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    s<span class="token punctuation">.</span>GarbageCollectorController<span class="token punctuation">.</span>GCIgnoredResources <span class="token operator">=</span> gcIgnoredResources

    <span class="token keyword">return</span> <span class="token operator">&amp;</span>s<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="22-addflagset">2.2. AddFlagSet</h2>
<p>&#x6DFB;&#x52A0;&#x53C2;&#x6570;&#x53CA;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x3002;</p>
<pre class="language-"><code class="lang-go">fs <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
namedFlagSets <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token function">KnownControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ControllersDisabledByDefault<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> namedFlagSets<span class="token punctuation">.</span>FlagSets <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">AddFlagSet</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
usageFmt <span class="token operator">:=</span> <span class="token string">&quot;Usage:\n  %s\n&quot;</span>
cols<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> apiserverflag<span class="token punctuation">.</span><span class="token function">TerminalSize</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">OutOrStdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cmd<span class="token punctuation">.</span><span class="token function">SetUsageFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>cmd <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">OutOrStderr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> usageFmt<span class="token punctuation">,</span> cmd<span class="token punctuation">.</span><span class="token function">UseLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    apiserverflag<span class="token punctuation">.</span><span class="token function">PrintSections</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">OutOrStderr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> namedFlagSets<span class="token punctuation">,</span> cols<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
cmd<span class="token punctuation">.</span><span class="token function">SetHelpFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>cmd <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">,</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">OutOrStdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;%s\n\n&quot;</span><span class="token operator">+</span>usageFmt<span class="token punctuation">,</span> cmd<span class="token punctuation">.</span>Long<span class="token punctuation">,</span> cmd<span class="token punctuation">.</span><span class="token function">UseLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    apiserverflag<span class="token punctuation">.</span><span class="token function">PrintSections</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">OutOrStdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> namedFlagSets<span class="token punctuation">,</span> cols<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="3-run">3. <a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/controllermanager.go#L141" target="_blank">Run</a></h1>
<blockquote>
<p>&#x6B64;&#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x4F4D;&#x4E8E;cmd/kube-controller-manager/app/controllermanager.go</p>
</blockquote>
<p>&#x57FA;&#x4E8E;<code>KubeControllerManagerOptions</code>&#x8FD0;&#x884C;controllerManager&#xFF0C;&#x4E0D;&#x9000;&#x51FA;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// Run runs the KubeControllerManagerOptions.  This should never exit.</span>
<span class="token keyword">func</span> <span class="token function">Run</span><span class="token punctuation">(</span>c <span class="token operator">*</span>config<span class="token punctuation">.</span>CompletedConfig<span class="token punctuation">,</span> stopCh <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    run <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
        controllerContext<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CreateControllerContext</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> rootClientBuilder<span class="token punctuation">,</span> clientBuilder<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            glog<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;error building controller context: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        saTokenControllerInitFunc <span class="token operator">:=</span> serviceAccountTokenControllerStarter<span class="token punctuation">{</span>rootClientBuilder<span class="token punctuation">:</span> rootClientBuilder<span class="token punctuation">}</span><span class="token punctuation">.</span>startServiceAccountTokenController

        <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">StartControllers</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">,</span> saTokenControllerInitFunc<span class="token punctuation">,</span> <span class="token function">NewControllerInitializers</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>LoopMode<span class="token punctuation">)</span><span class="token punctuation">,</span> unsecuredMux<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            glog<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;error starting controllers: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        controllerContext<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>Stop<span class="token punctuation">)</span>
        <span class="token function">close</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>InformersStarted<span class="token punctuation">)</span>

        <span class="token keyword">select</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Run&#x51FD;&#x6570;&#x6D89;&#x53CA;&#x7684;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// &#x521B;&#x5EFA;controller&#x7684;context</span>
controllerContext<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CreateControllerContext</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> rootClientBuilder<span class="token punctuation">,</span> clientBuilder<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &#x542F;&#x52A8;&#x5404;&#x79CD;controller</span>
err <span class="token operator">:=</span> <span class="token function">StartControllers</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">,</span> saTokenControllerInitFunc<span class="token punctuation">,</span> <span class="token function">NewControllerInitializers</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>LoopMode<span class="token punctuation">)</span><span class="token punctuation">,</span> unsecuredMux<span class="token punctuation">)</span>
</code></pre>
<p>&#x5176;&#x4E2D;<code>StartControllers</code>&#x4E2D;&#x7684;&#x5165;&#x53C2;<code>NewControllerInitializers</code>&#x521D;&#x59CB;&#x5316;&#x4E86;&#x5404;&#x79CD;controller&#x3002;</p>
<h2 id="31-createcontrollercontext">3.1. CreateControllerContext</h2>
<p><code>CreateControllerContext</code>&#x6784;&#x5EFA;&#x4E86;&#x5404;&#x79CD;controller&#x6240;&#x9700;&#x7684;&#x8D44;&#x6E90;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x5404;&#x79CD;controller&#x5728;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x5165;&#x53C2;&#x4E3A;&#x8BE5;context&#xFF0C;&#x5177;&#x4F53;&#x53C2;&#x8003;<code>initFn(ctx)</code>&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// CreateControllerContext creates a context struct containing references to resources needed by the</span>
<span class="token comment">// controllers such as the cloud provider and clientBuilder. rootClientBuilder is only used for</span>
<span class="token comment">// the shared-informers client and token controller.</span>
<span class="token keyword">func</span> <span class="token function">CreateControllerContext</span><span class="token punctuation">(</span>s <span class="token operator">*</span>config<span class="token punctuation">.</span>CompletedConfig<span class="token punctuation">,</span> rootClientBuilder<span class="token punctuation">,</span> clientBuilder controller<span class="token punctuation">.</span>ControllerClientBuilder<span class="token punctuation">,</span> stop <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ControllerContext<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    versionedClient <span class="token operator">:=</span> rootClientBuilder<span class="token punctuation">.</span><span class="token function">ClientOrDie</span><span class="token punctuation">(</span><span class="token string">&quot;shared-informers&quot;</span><span class="token punctuation">)</span>
    sharedInformers <span class="token operator">:=</span> informers<span class="token punctuation">.</span><span class="token function">NewSharedInformerFactory</span><span class="token punctuation">(</span>versionedClient<span class="token punctuation">,</span> <span class="token function">ResyncPeriod</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// If apiserver is not running we should wait for some time and fail only then. This is particularly</span>
    <span class="token comment">// important when we start apiserver and controller manager at the same time.</span>
    <span class="token keyword">if</span> err <span class="token operator">:=</span> genericcontrollermanager<span class="token punctuation">.</span><span class="token function">WaitForAPIServer</span><span class="token punctuation">(</span>versionedClient<span class="token punctuation">,</span> <span class="token number">10</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ControllerContext<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to wait for apiserver being healthy: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Use a discovery client capable of being refreshed.</span>
    discoveryClient <span class="token operator">:=</span> rootClientBuilder<span class="token punctuation">.</span><span class="token function">ClientOrDie</span><span class="token punctuation">(</span><span class="token string">&quot;controller-discovery&quot;</span><span class="token punctuation">)</span>
    cachedClient <span class="token operator">:=</span> cacheddiscovery<span class="token punctuation">.</span><span class="token function">NewMemCacheClient</span><span class="token punctuation">(</span>discoveryClient<span class="token punctuation">.</span><span class="token function">Discovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    restMapper <span class="token operator">:=</span> restmapper<span class="token punctuation">.</span><span class="token function">NewDeferredDiscoveryRESTMapper</span><span class="token punctuation">(</span>cachedClient<span class="token punctuation">)</span>
    <span class="token keyword">go</span> wait<span class="token punctuation">.</span><span class="token function">Until</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        restMapper<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span> stop<span class="token punctuation">)</span>

    availableResources<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">GetAvailableResources</span><span class="token punctuation">(</span>rootClientBuilder<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ControllerContext<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>

    cloud<span class="token punctuation">,</span> loopMode<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">createCloudProvider</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>KubeCloudShared<span class="token punctuation">.</span>CloudProvider<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> s<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>KubeCloudShared<span class="token punctuation">.</span>ExternalCloudVolumePlugin<span class="token punctuation">,</span>
        s<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>KubeCloudShared<span class="token punctuation">.</span>CloudProvider<span class="token punctuation">.</span>CloudConfigFile<span class="token punctuation">,</span> s<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>KubeCloudShared<span class="token punctuation">.</span>AllowUntaggedCloud<span class="token punctuation">,</span> sharedInformers<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ControllerContext<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>

    ctx <span class="token operator">:=</span> ControllerContext<span class="token punctuation">{</span>
        ClientBuilder<span class="token punctuation">:</span>      clientBuilder<span class="token punctuation">,</span>
        InformerFactory<span class="token punctuation">:</span>    sharedInformers<span class="token punctuation">,</span>
        ComponentConfig<span class="token punctuation">:</span>    s<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">,</span>
        RESTMapper<span class="token punctuation">:</span>         restMapper<span class="token punctuation">,</span>
        AvailableResources<span class="token punctuation">:</span> availableResources<span class="token punctuation">,</span>
        Cloud<span class="token punctuation">:</span>              cloud<span class="token punctuation">,</span>
        LoopMode<span class="token punctuation">:</span>           loopMode<span class="token punctuation">,</span>
        Stop<span class="token punctuation">:</span>               stop<span class="token punctuation">,</span>
        InformersStarted<span class="token punctuation">:</span>   <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ResyncPeriod<span class="token punctuation">:</span>       <span class="token function">ResyncPeriod</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ctx<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x4E3A;<code>NewSharedInformerFactory</code>&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// &#x521B;&#x5EFA;SharedInformerFactory</span>
sharedInformers <span class="token operator">:=</span> informers<span class="token punctuation">.</span><span class="token function">NewSharedInformerFactory</span><span class="token punctuation">(</span>versionedClient<span class="token punctuation">,</span> <span class="token function">ResyncPeriod</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &#x8D4B;&#x503C;&#x7ED9;ControllerContext</span>
ctx <span class="token operator">:=</span> ControllerContext<span class="token punctuation">{</span>
    InformerFactory<span class="token punctuation">:</span>    sharedInformers<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>SharedInformerFactory</code>&#x63D0;&#x4F9B;&#x4E86;&#x516C;&#x5171;&#x7684;k8s&#x5BF9;&#x8C61;&#x7684;<code>informers</code>&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// SharedInformerFactory provides shared informers for resources in all known</span>
<span class="token comment">// API group versions.</span>
<span class="token keyword">type</span> SharedInformerFactory <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    internalinterfaces<span class="token punctuation">.</span>SharedInformerFactory
    <span class="token function">ForResource</span><span class="token punctuation">(</span>resource schema<span class="token punctuation">.</span>GroupVersionResource<span class="token punctuation">)</span> <span class="token punctuation">(</span>GenericInformer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token function">WaitForCacheSync</span><span class="token punctuation">(</span>stopCh <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span>reflect<span class="token punctuation">.</span>Type<span class="token punctuation">]</span><span class="token builtin">bool</span>

    <span class="token function">Admissionregistration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> admissionregistration<span class="token punctuation">.</span>Interface
    <span class="token function">Apps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> apps<span class="token punctuation">.</span>Interface
    <span class="token function">Autoscaling</span><span class="token punctuation">(</span><span class="token punctuation">)</span> autoscaling<span class="token punctuation">.</span>Interface
    <span class="token function">Batch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> batch<span class="token punctuation">.</span>Interface
    <span class="token function">Certificates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> certificates<span class="token punctuation">.</span>Interface
    <span class="token function">Coordination</span><span class="token punctuation">(</span><span class="token punctuation">)</span> coordination<span class="token punctuation">.</span>Interface
    <span class="token function">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span> core<span class="token punctuation">.</span>Interface
    <span class="token function">Events</span><span class="token punctuation">(</span><span class="token punctuation">)</span> events<span class="token punctuation">.</span>Interface
    <span class="token function">Extensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> extensions<span class="token punctuation">.</span>Interface
    <span class="token function">Networking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> networking<span class="token punctuation">.</span>Interface
    <span class="token function">Policy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> policy<span class="token punctuation">.</span>Interface
    <span class="token function">Rbac</span><span class="token punctuation">(</span><span class="token punctuation">)</span> rbac<span class="token punctuation">.</span>Interface
    <span class="token function">Scheduling</span><span class="token punctuation">(</span><span class="token punctuation">)</span> scheduling<span class="token punctuation">.</span>Interface
    <span class="token function">Settings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> settings<span class="token punctuation">.</span>Interface
    <span class="token function">Storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> storage<span class="token punctuation">.</span>Interface
<span class="token punctuation">}</span>
</code></pre>
<h2 id="32-newcontrollerinitializers">3.2. NewControllerInitializers</h2>
<p><code>NewControllerInitializers</code>&#x5B9A;&#x4E49;&#x4E86;&#x5404;&#x79CD;controller&#x7684;&#x7C7B;&#x578B;&#x548C;&#x5176;&#x5BF9;&#x4E8E;&#x7684;&#x542F;&#x52A8;&#x51FD;&#x6570;&#xFF0C;&#x4F8B;&#x5982;<code>deployment``&#x3001;statefulset</code>&#x3001;<code>replicaset</code>&#x3001;<code>replicationcontroller</code>&#x3001;<code>namespace</code>&#x7B49;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// NewControllerInitializers is a public map of named controller groups (you can start more than one in an init func)</span>
<span class="token comment">// paired to their InitFunc.  This allows for structured downstream composition and subdivision.</span>
<span class="token keyword">func</span> <span class="token function">NewControllerInitializers</span><span class="token punctuation">(</span>loopMode ControllerLoopMode<span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>InitFunc <span class="token punctuation">{</span>
    controllers <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>InitFunc<span class="token punctuation">{</span><span class="token punctuation">}</span>
    controllers<span class="token punctuation">[</span><span class="token string">&quot;endpoint&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startEndpointController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;replicationcontroller&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startReplicationController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;podgc&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startPodGCController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;resourcequota&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startResourceQuotaController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;namespace&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startNamespaceController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;serviceaccount&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startServiceAccountController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;garbagecollector&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startGarbageCollectorController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;daemonset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startDaemonSetController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;job&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startJobController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;deployment&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startDeploymentController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;replicaset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startReplicaSetController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;horizontalpodautoscaling&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startHPAController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;disruption&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startDisruptionController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;statefulset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startStatefulSetController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;cronjob&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startCronJobController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;csrsigning&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startCSRSigningController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;csrapproving&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startCSRApprovingController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;csrcleaner&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startCSRCleanerController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;ttl&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startTTLController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;bootstrapsigner&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startBootstrapSignerController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;tokencleaner&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startTokenCleanerController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;nodeipam&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startNodeIpamController
    <span class="token keyword">if</span> loopMode <span class="token operator">==</span> IncludeCloudLoops <span class="token punctuation">{</span>
        controllers<span class="token punctuation">[</span><span class="token string">&quot;service&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startServiceController
        controllers<span class="token punctuation">[</span><span class="token string">&quot;route&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startRouteController
        <span class="token comment">// TODO: volume controller into the IncludeCloudLoops only set.</span>
        <span class="token comment">// TODO: Separate cluster in cloud check from node lifecycle controller.</span>
    <span class="token punctuation">}</span>
    controllers<span class="token punctuation">[</span><span class="token string">&quot;nodelifecycle&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startNodeLifecycleController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;persistentvolume-binder&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startPersistentVolumeBinderController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;attachdetach&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startAttachDetachController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;persistentvolume-expander&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startVolumeExpandController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;clusterrole-aggregation&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startClusterRoleAggregrationController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;pvc-protection&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startPVCProtectionController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;pv-protection&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startPVProtectionController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;ttl-after-finished&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startTTLAfterFinishedController

    <span class="token keyword">return</span> controllers
<span class="token punctuation">}</span>
</code></pre>
<h2 id="33-startcontrollers">3.3. StartControllers</h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">StartControllers</span><span class="token punctuation">(</span>ctx ControllerContext<span class="token punctuation">,</span> startSATokenController InitFunc<span class="token punctuation">,</span> controllers <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>InitFunc<span class="token punctuation">,</span> unsecuredMux <span class="token operator">*</span>mux<span class="token punctuation">.</span>PathRecorderMux<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">for</span> controllerName<span class="token punctuation">,</span> initFn <span class="token operator">:=</span> <span class="token keyword">range</span> controllers <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>ctx<span class="token punctuation">.</span><span class="token function">IsControllerEnabled</span><span class="token punctuation">(</span>controllerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            glog<span class="token punctuation">.</span><span class="token function">Warningf</span><span class="token punctuation">(</span><span class="token string">&quot;%q is disabled&quot;</span><span class="token punctuation">,</span> controllerName<span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>wait<span class="token punctuation">.</span><span class="token function">Jitter</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>Generic<span class="token punctuation">.</span>ControllerStartInterval<span class="token punctuation">.</span>Duration<span class="token punctuation">,</span> ControllerStartJitter<span class="token punctuation">)</span><span class="token punctuation">)</span>

        glog<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">&quot;Starting %q&quot;</span><span class="token punctuation">,</span> controllerName<span class="token punctuation">)</span>
        debugHandler<span class="token punctuation">,</span> started<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">initFn</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            glog<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Error starting %q&quot;</span><span class="token punctuation">,</span> controllerName<span class="token punctuation">)</span>
            <span class="token keyword">return</span> err
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>started <span class="token punctuation">{</span>
            glog<span class="token punctuation">.</span><span class="token function">Warningf</span><span class="token punctuation">(</span><span class="token string">&quot;Skipping %q&quot;</span><span class="token punctuation">,</span> controllerName<span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> debugHandler <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> unsecuredMux <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            basePath <span class="token operator">:=</span> <span class="token string">&quot;/debug/controllers/&quot;</span> <span class="token operator">+</span> controllerName
            unsecuredMux<span class="token punctuation">.</span><span class="token function">UnlistedHandle</span><span class="token punctuation">(</span>basePath<span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">StripPrefix</span><span class="token punctuation">(</span>basePath<span class="token punctuation">,</span> debugHandler<span class="token punctuation">)</span><span class="token punctuation">)</span>
            unsecuredMux<span class="token punctuation">.</span><span class="token function">UnlistedHandlePrefix</span><span class="token punctuation">(</span>basePath<span class="token operator">+</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">StripPrefix</span><span class="token punctuation">(</span>basePath<span class="token punctuation">,</span> debugHandler<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        glog<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">&quot;Started %q&quot;</span><span class="token punctuation">,</span> controllerName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">for</span> controllerName<span class="token punctuation">,</span> initFn <span class="token operator">:=</span> <span class="token keyword">range</span> controllers <span class="token punctuation">{</span>
    debugHandler<span class="token punctuation">,</span> started<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">initFn</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x542F;&#x52A8;&#x5404;&#x79CD;controller&#xFF0C;controller&#x7684;&#x542F;&#x52A8;&#x51FD;&#x6570;&#x5728;<code>NewControllerInitializers</code>&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// deployment</span>
controllers<span class="token punctuation">[</span><span class="token string">&quot;deployment&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startDeploymentController
<span class="token comment">// statefulset</span>
controllers<span class="token punctuation">[</span><span class="token string">&quot;statefulset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startStatefulSetController
</code></pre>
<h2 id="34-informerfactorystart">3.4. InformerFactory.Start</h2>
<p><code>InformerFactory</code>&#x5B9E;&#x9645;&#x4E0A;&#x662F;<code>SharedInformerFactory</code>&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x5728;<code>client-go</code>&#x4E2D;&#x7684;informer&#x7684;&#x5B9E;&#x73B0;&#x673A;&#x5236;&#x3002;</p>
<pre class="language-"><code class="lang-go">controllerContext<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>Stop<span class="token punctuation">)</span>
<span class="token function">close</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>InformersStarted<span class="token punctuation">)</span>
</code></pre>
<h3 id="341-sharedinformerfactory">3.4.1. SharedInformerFactory</h3>
<p>SharedInformerFactory&#x662F;&#x4E00;&#x4E2A;informer&#x5DE5;&#x5382;&#x7684;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// SharedInformerFactory a small interface to allow for adding an informer without an import cycle</span>
<span class="token keyword">type</span> SharedInformerFactory <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Start</span><span class="token punctuation">(</span>stopCh <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">InformerFor</span><span class="token punctuation">(</span>obj runtime<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> newFunc NewInformerFunc<span class="token punctuation">)</span> cache<span class="token punctuation">.</span>SharedIndexInformer
<span class="token punctuation">}</span>
</code></pre>
<h3 id="342-sharedinformerfactorystart">3.4.2. sharedInformerFactory.Start</h3>
<p>Start&#x65B9;&#x6CD5;&#x521D;&#x59CB;&#x5316;&#x5404;&#x79CD;&#x7C7B;&#x578B;&#x7684;informer</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// Start initializes all requested informers.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>sharedInformerFactory<span class="token punctuation">)</span> <span class="token function">Start</span><span class="token punctuation">(</span>stopCh <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">defer</span> f<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> informerType<span class="token punctuation">,</span> informer <span class="token operator">:=</span> <span class="token keyword">range</span> f<span class="token punctuation">.</span>informers <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>f<span class="token punctuation">.</span>startedInformers<span class="token punctuation">[</span>informerType<span class="token punctuation">]</span> <span class="token punctuation">{</span>
            <span class="token keyword">go</span> informer<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>stopCh<span class="token punctuation">)</span>
            f<span class="token punctuation">.</span>startedInformers<span class="token punctuation">[</span>informerType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="343-sharedindexinformerrun">3.4.3. sharedIndexInformer.Run</h3>
<p>sharedIndexInformer.Run&#x5177;&#x4F53;&#x8FD0;&#x884C;&#x4E86;sharedIndexInformer&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#xFF0C;&#x8BE5;&#x90E8;&#x5206;&#x5F85;&#x540E;&#x7EED;&#x5BF9;informer&#x673A;&#x5236;&#x505A;&#x4E13;&#x9898;&#x5206;&#x6790;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>sharedIndexInformer<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span>stopCh <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> utilruntime<span class="token punctuation">.</span><span class="token function">HandleCrash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    fifo <span class="token operator">:=</span> <span class="token function">NewDeltaFIFO</span><span class="token punctuation">(</span>MetaNamespaceKeyFunc<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>indexer<span class="token punctuation">)</span>

    cfg <span class="token operator">:=</span> <span class="token operator">&amp;</span>Config<span class="token punctuation">{</span>
        Queue<span class="token punctuation">:</span>            fifo<span class="token punctuation">,</span>
        ListerWatcher<span class="token punctuation">:</span>    s<span class="token punctuation">.</span>listerWatcher<span class="token punctuation">,</span>
        ObjectType<span class="token punctuation">:</span>       s<span class="token punctuation">.</span>objectType<span class="token punctuation">,</span>
        FullResyncPeriod<span class="token punctuation">:</span> s<span class="token punctuation">.</span>resyncCheckPeriod<span class="token punctuation">,</span>
        RetryOnError<span class="token punctuation">:</span>     <span class="token boolean">false</span><span class="token punctuation">,</span>
        ShouldResync<span class="token punctuation">:</span>     s<span class="token punctuation">.</span>processor<span class="token punctuation">.</span>shouldResync<span class="token punctuation">,</span>

        Process<span class="token punctuation">:</span> s<span class="token punctuation">.</span>HandleDeltas<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>startedLock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">defer</span> s<span class="token punctuation">.</span>startedLock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        s<span class="token punctuation">.</span>controller <span class="token operator">=</span> <span class="token function">New</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>controller<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>controller<span class="token punctuation">)</span><span class="token punctuation">.</span>clock <span class="token operator">=</span> s<span class="token punctuation">.</span>clock
        s<span class="token punctuation">.</span>started <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Separate stop channel because Processor should be stopped strictly after controller</span>
    processorStopCh <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> wg wait<span class="token punctuation">.</span>Group
    <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment">// Wait for Processor to stop</span>
    <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>processorStopCh<span class="token punctuation">)</span> <span class="token comment">// Tell Processor to stop</span>
    wg<span class="token punctuation">.</span><span class="token function">StartWithChannel</span><span class="token punctuation">(</span>processorStopCh<span class="token punctuation">,</span> s<span class="token punctuation">.</span>cacheMutationDetector<span class="token punctuation">.</span>Run<span class="token punctuation">)</span>
    wg<span class="token punctuation">.</span><span class="token function">StartWithChannel</span><span class="token punctuation">(</span>processorStopCh<span class="token punctuation">,</span> s<span class="token punctuation">.</span>processor<span class="token punctuation">.</span>run<span class="token punctuation">)</span>

    <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>startedLock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">defer</span> s<span class="token punctuation">.</span>startedLock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>stopped <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// Don&apos;t want any new listeners</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>controller<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>stopCh<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="4-initfnctx">4. initFn(ctx)</h1>
<p><code>initFn</code>&#x5B9E;&#x9645;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F;&#x5404;&#x79CD;&#x7C7B;&#x578B;&#x7684;controller&#xFF0C;&#x4EE3;&#x7801;&#x4F4D;&#x4E8E;<code>kubernetes/cmd/kube-controller-manager/app/apps.go</code>&#xFF0C;&#x672C;&#x6587;&#x4EE5;<code>startStatefulSetController</code>&#x548C;<code>startDeploymentController</code>&#x4E3A;&#x4F8B;&#xFF0C;controller&#x4E2D;&#x5B9E;&#x9645;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x903B;&#x8F91;&#x4F4D;&#x4E8E;<code>kubernetes/pkg/controller</code>&#x4E2D;&#xFF0C;&#x5F85;&#x540E;&#x7EED;&#x5206;&#x6790;&#x3002;</p>
<h2 id="41-startstatefulsetcontroller">4.1. <a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/apps.go#L55" target="_blank">startStatefulSetController</a></h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">startStatefulSetController</span><span class="token punctuation">(</span>ctx ControllerContext<span class="token punctuation">)</span> <span class="token punctuation">(</span>http<span class="token punctuation">.</span>Handler<span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>ctx<span class="token punctuation">.</span>AvailableResources<span class="token punctuation">[</span>schema<span class="token punctuation">.</span>GroupVersionResource<span class="token punctuation">{</span>Group<span class="token punctuation">:</span> <span class="token string">&quot;apps&quot;</span><span class="token punctuation">,</span> Version<span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> Resource<span class="token punctuation">:</span> <span class="token string">&quot;statefulsets&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">go</span> statefulset<span class="token punctuation">.</span><span class="token function">NewStatefulSetController</span><span class="token punctuation">(</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Apps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">StatefulSets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PersistentVolumeClaims</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Apps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ControllerRevisions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>ClientBuilder<span class="token punctuation">.</span><span class="token function">ClientOrDie</span><span class="token punctuation">(</span><span class="token string">&quot;statefulset-controller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>Stop<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5176;&#x4E2D;&#x4F7F;&#x7528;&#x5230;&#x4E86;<code>InformerFactory</code>&#xFF0C;&#x5305;&#x542B;&#x4E86;Pods&#x3001;StatefulSets&#x3001;PersistentVolumeClaims&#x3001;ControllerRevisions&#x7684;informer&#x3002;</p>
<p><code>startStatefulSetController</code>&#x4E3B;&#x8981;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x4E3A;<code>NewStatefulSetController</code>&#x548C;&#x5BF9;&#x5E94;&#x7684;<code>Run</code>&#x51FD;&#x6570;&#x3002;</p>
<h2 id="42-startdeploymentcontroller">4.2. <a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/apps.go#L82" target="_blank">startDeploymentController</a></h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">startDeploymentController</span><span class="token punctuation">(</span>ctx ControllerContext<span class="token punctuation">)</span> <span class="token punctuation">(</span>http<span class="token punctuation">.</span>Handler<span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>ctx<span class="token punctuation">.</span>AvailableResources<span class="token punctuation">[</span>schema<span class="token punctuation">.</span>GroupVersionResource<span class="token punctuation">{</span>Group<span class="token punctuation">:</span> <span class="token string">&quot;apps&quot;</span><span class="token punctuation">,</span> Version<span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> Resource<span class="token punctuation">:</span> <span class="token string">&quot;deployments&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    dc<span class="token punctuation">,</span> err <span class="token operator">:=</span> deployment<span class="token punctuation">.</span><span class="token function">NewDeploymentController</span><span class="token punctuation">(</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Apps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Deployments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Apps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReplicaSets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>ClientBuilder<span class="token punctuation">.</span><span class="token function">ClientOrDie</span><span class="token punctuation">(</span><span class="token string">&quot;deployment-controller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;error creating Deployment controller: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">go</span> dc<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>DeploymentController<span class="token punctuation">.</span>ConcurrentDeploymentSyncs<span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>Stop<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>startDeploymentController</code>&#x4E3B;&#x8981;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x4E3A;<code>NewDeploymentController</code>&#x548C;&#x5BF9;&#x5E94;&#x7684;<code>Run</code>&#x51FD;&#x6570;&#x3002;&#x8BE5;&#x90E8;&#x5206;&#x903B;&#x8F91;&#x5728;<code>kubernetes/pkg/controller</code>&#x4E2D;&#x3002;</p>
<h1 id="5-&#x603B;&#x7ED3;">5. &#x603B;&#x7ED3;</h1>
<ol>
<li>Kube-controller-manager&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#x4ECD;&#x7136;&#x662F;<a href="https://github.com/spf13/cobra" target="_blank">Cobra</a>&#x547D;&#x4EE4;&#x884C;&#x6846;&#x67B6;&#x3002;&#x901A;&#x8FC7;&#x6784;&#x9020;<code>ControllerManagerCommand</code>&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;<code>command.Execute()</code>&#x51FD;&#x6570;&#x3002;&#x57FA;&#x672C;&#x7684;&#x6D41;&#x7A0B;&#x5C31;&#x662F;&#x6784;&#x9020;option&#xFF0C;&#x6DFB;&#x52A0;Flags&#xFF0C;&#x6267;&#x884C;Run&#x51FD;&#x6570;&#x3002;</li>
<li>cmd&#x90E8;&#x5206;&#x7684;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;<code>Main--&gt;NewControllerManagerCommand--&gt; Run(c.Complete(), wait.NeverStop)--&gt;StartControllers--&gt;initFn(ctx)--&gt;startDeploymentController/startStatefulSetController--&gt;sts.NewStatefulSetController.Run/dc.NewDeploymentController.Run--&gt;pkg/controller</code>&#x3002;</li>
<li>&#x5176;&#x4E2D;<code>CreateControllerContext</code>&#x51FD;&#x6570;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x5404;&#x7C7B;&#x578B;controller&#x6240;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7684;context&#xFF0C;<code>NewControllerInitializers</code>&#x521D;&#x59CB;&#x5316;&#x4E86;&#x5404;&#x79CD;&#x7C7B;&#x578B;&#x7684;controller&#xFF0C;&#x5176;&#x4E2D;&#x5C31;&#x5305;&#x62EC;<code>DeploymentController</code>&#x548C;<code>StatefulSetController</code>&#x7B49;&#x3002;</li>
</ol>
<p>&#x57FA;&#x672C;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x6784;&#x9020;controller manager option&#xFF0C;&#x5E76;&#x8F6C;&#x5316;&#x4E3A;Config&#x5BF9;&#x8C61;&#xFF0C;&#x6267;&#x884C;Run&#x51FD;&#x6570;&#x3002;</li>
<li>&#x57FA;&#x4E8E;Config&#x5BF9;&#x8C61;&#x521B;&#x5EFA;ControllerContext&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;InformerFactory&#x3002;</li>
<li>&#x57FA;&#x4E8E;ControllerContext&#x8FD0;&#x884C;&#x5404;&#x79CD;controller&#xFF0C;&#x5404;&#x79CD;controller&#x7684;&#x5B9A;&#x4E49;&#x5728;<code>NewControllerInitializers</code>&#x4E2D;&#x3002;</li>
<li>&#x6267;&#x884C;InformerFactory.Start&#x3002;</li>
<li>&#x6BCF;&#x79CD;controller&#x90FD;&#x4F1A;&#x6784;&#x9020;&#x81EA;&#x8EAB;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x5E76;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;Run&#x51FD;&#x6570;&#x3002;</li>
</ol>
<p>&#x53C2;&#x8003;&#xFF1A;</p>
<ul>
<li><a href="https://github.com/kubernetes/kubernetes/tree/v1.12.0/cmd/kube-controller-manager" target="_blank">https://github.com/kubernetes/kubernetes/tree/v1.12.0/cmd/kube-controller-manager</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/controller-manager.go" target="_blank">https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/controller-manager.go</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/controllermanager.go" target="_blank">https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/controllermanager.go</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/apps.go" target="_blank">https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/apps.go</a></li>
</ul>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; www.huweihuang.com 2017-2018 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">Updated at 
2019-07-31 10:18:04
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="controller-manager-xmind.html" class="navigation navigation-prev " aria-label="Previous page: 源码思维导图">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="deployment-controller.html" class="navigation navigation-next " aria-label="Next page: DeploymentController">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"NewControllerManagerCommand","level":"3.2","depth":1,"next":{"title":"DeploymentController","level":"3.3","depth":1,"path":"kube-controller-manager/deployment-controller.md","ref":"kube-controller-manager/deployment-controller.md","articles":[]},"previous":{"title":"源码思维导图","level":"3.1","depth":1,"path":"kube-controller-manager/controller-manager-xmind.md","ref":"kube-controller-manager/controller-manager-xmind.md","articles":[]},"dir":"ltr"},"config":{"plugins":["github","codesnippet","splitter","page-toc-button","image-captions","editlink","back-to-top-button","-lunr","-search","search-plus","github-buttons@2.1.0","favicon@^0.0.2","tbfed-pagefooter@^0.0.1","3-ba","theme-default","-highlight","prism","prism-themes","sitemap-general","ga","disqus","donate"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright © www.huweihuang.com 2017-2018","modify_label":"Updated at ","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prismjs/themes/prism-okaidia.css"]},"disqus":{"useIdentifier":false,"shortName":"huweihuang"},"github":{"url":"https://github.com/huweihuang"},"editlink":{"label":"编辑本页","multilingual":false,"base":"https://github.com/huweihuang/k8s-source-code-analysis/blob/master/"},"splitter":{},"donate":{"alipay":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1551599640/blog/donate/alipay.jpg","alipayText":"支付宝打赏","button":"赏","title":"","wechat":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1551599472/blog/donate/wechatpay.jpg","wechatText":"微信打赏"},"codesnippet":{},"sitemap-general":{"prefix":"https://www.huweihuang.com/k8s-source-code-analysis/"},"fontsettings":{"theme":"white","family":"sans","size":2},"favicon":{"shortcut":"images/favicon.ico","bookmark":"images/favicon.ico","appleTouch":"images/favicon.ico","appleTouchMore":{"120x120":"images/favicon.ico","180x180":"images/favicon.ico"}},"page-toc-button":{},"back-to-top-button":{},"prism-themes":{},"github-buttons":{"repo":"huweihuang/k8s-source-code-analysis","types":["star"],"size":"small"},"3-ba":{"configuration":"auto","token":"e146d71b77957235bba1e709d930f62e"},"ga":{"configuration":"auto","token":"UA-114718458-2"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"showLevel":true,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"search-plus":{},"image-captions":{"caption":"图片 - _CAPTION_","variable_name":"_pictures"}},"theme":"default","author":"胡伟煌","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"_pictures":[]},"title":"Kubernetes 学习笔记","language":"zh-hans","links":{"sidebar":{"胡伟煌的博客":"https://www.huweihuang.com","Kubernetes 学习笔记":"https://www.huweihuang.com/kubernetes-notes/","Golang 学习笔记":"https://www.huweihuang.com/golang-notes/","Linux 学习笔记":"https://www.huweihuang.com/linux-notes/","数据结构学习笔记":"https://www.huweihuang.com/data-structure-notes/","Python 学习笔记":"https://www.huweihuang.com/python-notes/","Blockchain 学习笔记":"https://www.huweihuang.com/blockchain-notes/"}},"gitbook":"*","description":"Kubernetes 学习笔记"},"file":{"path":"kube-controller-manager/NewControllerManagerCommand.md","mtime":"2019-07-31T02:18:04.144Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-04-18T05:15:12.926Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-editlink/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-3-ba/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

